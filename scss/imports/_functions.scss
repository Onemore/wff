// wff functions
// -------------
// documentation: none

// map-set() - not included with Sass
// thanks @oddbird (http://oddbird.net/2013/10/19/map-merge/)

@function map-set($map, $key, $value) {
  $new: ($key: $value);
  @return map-merge($map, $new);
}

// wff-get() - get $wff value
// short for map-get($wff, $key)
// can also deliver computed values

@function wff-get($key) {
  @if map-has-key($wff, $key) {
    @return map-get($wff, $key); }

  $fluid:   wff-get(math) == fluid;
  $static:  wff-get(math) == static;
  $width:   wff-get(width);
  $columns: wff-get(columns);
  $gutters: wff-get(gutters);

  $result:  null;

  @if $key == column-size {
    $gutters-nbr: $gutters * ($columns - 1);
    $columns-size: $width - $gutters-nbr;
    $column-size: $columns-size / $columns;
    $result: $width / $column-size;
  }
  @else if $key == span-size {
    $span-size: $width / $columns;
    $result: $width / $span-size;
  }
  @else if $key == gutter-size {
    $result: $width / $gutters;
  }

  @if $result {
    @if $fluid {
      $result: 100% / $result;
    }
    @if $static {
      $result: $width / $result;
    }
  }

  @return $result;
}

// layout() - generate a layout from the default one
// merge $map and $wff and return result

@function layout($map) {
  $new: $wff;
  @each $key, $value in $map {
    @if map-has-key($wff, $key) {
      $new: map-set($new, $key, $value);
    }
  }

  @return $new;
}

// default-layout() - override default layout
// merge $map and $wff in $wff global

@function default-layout($map) {
  $wff: layout($map) !global;

  @return $wff;
}

// precision() - because sometimes you don't want to use --precision
// from gist (https://gist.github.com/zoontek/37dcc670f128f41747b7)

@function precision($number, $decimals) {
  @if $decimals < 1 {
    @return round($number);
  }
  @if $number == round($number) {
    @return $number;
  }

  $square: 1;
  @for $i from 1 through $decimals {
    $square: $square * 10;
  }

  @return round($number * $square) / $square;
}
