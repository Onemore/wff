// wff mixins
// ----------
// documentation: 

// container
// $position: center / left / right

@mixin container($position: center) {
  @if $position == center {
    @extend %container-center-#{$wff-id};
  }
  @else if $position == left {
    @extend %container-left-#{$wff-id};
  }
  @else if $position == right {
    @extend %container-right-#{$wff-id};
  }
}

// row

@mixin row() {
  @extend %row-#{$wff-id};
}

// column
// $size:     unitless
// $position: none / last / shift n

@mixin column($size: 1, $position: none) {
  @if (length($size) == 1) {
    @extend %column-#{$size}-#{$wff-id};

    @if $position == none {
      @extend %column-none-#{$wff-id};
    }
    @else if $position == last {
      @extend %column-last-#{$wff-id};
    }
    @else if nth($position, 1) == shift {
      @extend %column-none-#{$wff-id};
      @extend %column-shift-#{nth($position, 2)}-#{$wff-id};
    }
  }
  @else if (length($size) >= 3 and nth($size, 2) == of) {
    @extend %column-#{nth($size, 1)}-of-#{nth($size, 3)};
    @extend %column-none-of-#{nth($size, 3)}-#{$wff-id};
  }
}

// span
// $size:     unitless
// $position: none / last / shift n

@mixin span($size: 1, $position: none) {
  @extend %span-#{$size}-#{$wff-id};

  @if $position == none {
    @extend %span-none-#{$wff-id};
  }
  @else if $position == last {
    @extend %span-last-#{$wff-id};
  }
  @else if nth($position, 1) == shift {
    @extend %span-none-#{$wff-id};
    @extend %span-shift-#{nth($position, 2)}-#{$wff-id};
  }
}

// column-gallery
// $size:  unitless
// $unset: unitless

@mixin column-gallery($size: 1, $unset: 0) {
  @extend %column-#{$size}-#{$wff-id};
  @extend %column-none-#{$wff-id};

  $per-line: ceil(wff-get(columns) / $size);

  @if $unset > 0 {
    &:nth-of-type(#{$unset}n) {
      @extend %column-#{$size}-#{$wff-id};
    }
  }
  &:nth-of-type(#{$per-line}n+#{$per-line}) {
    @extend %column-last-#{$wff-id};
  }
}

// span-gallery
// $size:  unitless
// $unset: unitless

@mixin span-gallery($size: 1, $unset: 0) {  
  @extend %span-#{$size}-#{$wff-id};
  @extend %span-none-#{$wff-id};

  $per-line: ceil(wff-get(columns) / $size);

  @if $unset > 0 {
    &:nth-of-type(#{$unset}n) {
      @extend %span-#{$size}-#{$wff-id};
    }
  }
  &:nth-of-type(#{$per-line}n+#{$per-line}) {
    @extend %span-last-#{$wff-id};
  }
}

// placeholders

@mixin placeholders() {
  $math:        wff-get(math);
  $fluid:       wff-get(math) == fluid;
  $static:      wff-get(math) == static;
  $width:       wff-get(width);
  $columns:     wff-get(columns);
  $gutters:     wff-get(gutters);

  $column-size: math-get(column-size);
  $span-size:   math-get(span-size);
  $gutter-size: math-get(gutter-size);
  $cs-static:   math-get(column-size, static);
  $gs-static:   math-get(gutter-size, static);
  
  // container
  %container-center-#{$wff-id} {
    @if $fluid { max-width: $width; }
    @if $static { width: $width; }
    margin-right: auto;
    margin-left: auto;
  }
  %container-left-#{$wff-id} {
    @if $fluid { max-width: $width; }
    @if $static { width: $width; }
    margin-right: auto;
    margin-left: 0;
  }
  %container-right-#{$wff-id} {
    @if $fluid { max-width: $width; }
    @if $static { width: $width; }
    margin-right: 0;
    margin-left: auto;
  }

  // row
  %row-#{$wff-id} {
    &:after {
      content: "";
      display: block;
      clear: both;
    }
  }

  // column
  @for $size from 1 through $columns {
    %column-#{$size}-#{$wff-id} {
      width: ($column-size + $gutter-size) * $size - $gutter-size;
    }
  }
  %column-none-#{$wff-id} {
    float: left;
    margin-right: $gutter-size;
  }
  @for $container-columns from 2 through ($columns - 1) {
    $sub-width: ($cs-static + $gs-static) * $container-columns - $gs-static;
    $cs-nest: math-get(column-size, $math, $sub-width, $container-columns);
    $gs-nest: math-get(gutter-size, $math, $sub-width, $container-columns);

    @for $size from 1 through ($container-columns - 1) {
      %column-#{$size}-of-#{$container-columns} {
        width: ($cs-nest + $gs-nest) * $size - $gs-nest;
      }

    }
    %column-none-of-#{$container-columns}-#{$wff-id} {
      float: left;
      margin-right: $gs-nest;
    }
  }
  %column-last-#{$wff-id} {
    float: right;
    margin-right: 0;
  }
  @for $shift from 1 through ($columns - 2) {
    // shifting
    %column-shift-#{$shift}-#{$wff-id} {
      margin-left: ($column-size + $gutter-size) * $shift;
    }
  }

  // span
  @for $size from 1 through $columns {
    %span-#{$size}-#{$wff-id} {
      width: $span-size * $size;
    }
  }
  %span-none-#{$wff-id} {
    float: left;
  }
  %span-last-#{$wff-id} {
    float: right;
  }
  @for $shift from 1 through ($columns - 2) {
    %span-shift-#{$shift}-#{$wff-id} {
      margin-left: $span-size * $shift;
    }
  }
}

// breakpoint
// $query:        string
// $layout:       map
// $placeholders: boolean

@mixin breakpoint($query: 'screen', $layout: $wff, $placeholders: true) {
  @media #{$query} {
    $old:    $wff;
    $wff:    $layout     !global;
    $wff-id: unique-id() !global;

    @if $placeholders {
      @include placeholders;
    }
    @content;

    $wff:    $old !global;
    $wff-id: null !global;
  }
}
